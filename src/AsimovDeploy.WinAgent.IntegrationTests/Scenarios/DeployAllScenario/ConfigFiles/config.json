{
  "WebPort": %AGENT_PORT%,
  "DataFolder": "%DATA_FOLDER%",
  "HeartbeatIntervalSeconds": 10,
  "NodeFrontUrl": "%NODE_FRONT_URL%",
  "Environment": "dev",
  "ConfigVersion": 1,

  "PackageSources": {
    "PS": {
      "Type": "FileSystem",
      "Uri": "%PACKAGES_URI%\\PS"
    },
    "Service": {
      "Type": "FileSystem",
      "Uri": "%PACKAGES_URI%\\Service"
    },
    "Web": {
      "Type": "FileSystem",
      "Uri": "%PACKAGES_URI%\\Web"
    }
  },

  "Units": [
    {
      "Name": "Asimov.Roundhouse.Example",
      "ServiceName": "Asimov.Roundhouse.Example",
      "Type": "WindowsService",
      "PackageInfo": { "Source": "Service" },
      "Installable": {
        "TargetPath": "%DATA_FOLDER%\\WindowsServiceTarget",
        "Install": ".\\Asimov.Roundhouse.Example.exe install -servicename:\"$ServiceName\" -displayname:\"$DisplayName\"",
        "InstallParameters": {
          "DisplayName": {
            "Type": "Text",
            "Default": "Asimov.Roundhouse.Example"
          }
        },
        "Uninstall": ".\\Asimov.Roundhouse.Example.exe uninstall -servicename:\"$ServiceName\""
      }
    },

    {
      "Name": "Asimov.Roundhouse.Example.From.Scripts",
      "ServiceName": "Asimov.Roundhouse.Example.From.Scripts",
      "Type": "WindowsService",
      "PackageInfo": { "Source": "Service" },
      "Installable": {
        "TargetPath": "%DATA_FOLDER%\\WindowsServiceFromScriptsTarget",
        "Install": "install-service.ps1 -ServiceExecutable .\\Asimov.Roundhouse.Example.exe -ServiceName $ServiceName -DisplayName $DisplayName",
        "Uninstall": "uninstall-service.ps1 -ServiceExecutable .\\Asimov.Roundhouse.Example.exe -ServiceName $ServiceName"
      }
    },
    {
      "Name": "Asimov.Web.Example",
      "Type": "WebSite",
      "SiteName": "Asimov.Web.Example",
      "SiteUrl": "http://localhost:9123",
      "PackageInfo": { "Source": "Web" },
      "Installable": {
        "TargetPath": "%DATA_FOLDER%\\WebTarget",
        "Install": "
        Import-module WebAdministration;
New-WebAppPool -Name \"${SiteName}AppPool\"
$pool = Get-Item \"IIS:\\AppPools\\${SiteName}AppPool\"
$pool.startMode = 'AlwaysRunning'
$pool | Set-Item
New-WebSite -Name $SiteName -ApplicationPool \"${SiteName}AppPool\" -PhysicalPath \"$(pwd)\" -Port ([System.Uri]$SiteUrl).Port
Set-ItemProperty IIS:\\Sites\\$SiteName -name EnabledProtocols -value 'http,net.pipe,net.tcp'
#Remove-ItemProperty -path IIS:\\Sites\\$SiteName -name bindings
New-ItemProperty -Path IIS:\\Sites\\$SiteName -name bindings -value @{protocol='net.tcp';bindingInformation=\"${Port}:*\"}
New-ItemProperty -Path IIS:\\Sites\\$SiteName -name bindings -value @{protocol='net.pipe';bindingInformation='*';ipaddress='*'}
        ",
        "InstallParameters": {
          "Port": { "Type": "Text", "Default": "8123"}
        },
        "Uninstall": "\r\n
Import-module WebAdministration;\r\n
Remove-WebSite -name $SiteName
Remove-WebAppPool -Name \"${SiteName}AppPool\" 
        "
      }
    },
      {
        "Name": "Asimov.Web.Example.From.Script",
        "Type": "WebSite",
        "SiteName": "Asimov.Web.Example.From.Script",
        "SiteUrl": "http://localhost:9124",
        "PackageInfo": { "Source": "Web" },
        "Installable": {
          "TargetPath": "%DATA_FOLDER%\\WebTargetFromScript",
          "Install": "install-site.ps1 $SiteName $SiteUrl",
          "Uninstall": "uninstall-site.ps1 $SiteName"
        }
      },

      {
			"Name": "PSTest",
			"Type": "PowerShell",
			
			"PackageInfo": { "Source": "PS" },

            "Url": "http://localhost:2121",
            
            "DeployParameters": {
                "Tasks": { "Type": "Text", "Default": "Deploy-Everything" }
            },

            "Script":
			"
                $Tasks.Split(\" \") | ForEach {
                    New-Item \"$_.txt\" -type file
                }
			"
		}
  ]
}